"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[736],{5736:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"posting-container"},[t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("过账管理")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:e.handleAdd}},[e._v("新增过账")])],1),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"会计分录ID"}},[t("el-select",{attrs:{placeholder:"请选择会计分录"},model:{value:e.searchForm.entryId,callback:function(t){e.$set(e.searchForm,"entryId",t)},expression:"searchForm.entryId"}},e._l(e.journalEntryList,function(a){return t("el-option",{key:a.id,attrs:{label:e.formatJournalEntryText(a),value:a.id}})}),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.postingList}},[t("el-table-column",{attrs:{prop:"entryId",label:"会计分录"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.forEnText(t.row.entryId))+" ")]}}])}),t("el-table-column",{attrs:{prop:"postingDate",label:"过账日期"}}),t("el-table-column",{attrs:{prop:"postingUserId",label:"过账用户"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleDelete(a.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next, jumper, total",total:e.total,"current-page":e.currentPage,"page-size":e.pageSize},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1),t("el-dialog",{attrs:{visible:e.dialogVisible,title:e.dialogTitle,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"会计分录",prop:"entryId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择会计分录"},model:{value:e.formData.entryId,callback:function(t){e.$set(e.formData,"entryId",t)},expression:"formData.entryId"}},e._l(e.journalEntryList,function(a){return t("el-option",{key:a.id,attrs:{label:e.formatJournalEntryText(a),value:a.id}})}),1)],1),t("el-form-item",{attrs:{label:"过账日期",prop:"postingDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择过账日期","value-format":"yyyy-MM-dd"},model:{value:e.formData.postingDate,callback:function(t){e.$set(e.formData,"postingDate",t)},expression:"formData.postingDate"}})],1),t("el-form-item",{attrs:{label:"过账账户",prop:"postingUserId"}},[t("el-input",{attrs:{placeholder:"请输入过账用户"},model:{value:e.formData.postingUserId,callback:function(t){e.$set(e.formData,"postingUserId",t)},expression:"formData.postingUserId"}})],1)],1),t("template",{slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],2)],1)},s=[],o=a(7277);function n(e){return(0,o.A)({url:"/posting/page",method:"get",params:e})}function i(e){const t={id:e.id,entryId:e.entryId,postingDate:e.postingDate,postingUserId:e.postingUserId};return(0,o.A)({url:e.id?"/posting/update":"/posting/insert",method:e.id?"put":"post",data:t})}function l(e){return(0,o.A)({url:`/posting/${e}`,method:"delete"})}function d(e={}){return(0,o.A)({url:"/journal-entry/page",method:"get",params:{pageNum:e.pageNum||1,pageSize:e.pageSize||100,...e}})}var c={name:"Posting",data(){return{loading:!1,postingList:[],journalEntryList:[],searchForm:{postingDate:"",entryId:null},formData:{id:null,entryId:null,postingDate:"",postingUserId:null},dialogVisible:!1,dialogTitle:"",formRef:null,total:0,currentPage:1,pageSize:10,rules:{entryId:[{required:!0,message:"请输入会计分录ID",trigger:"blur"}],postingDate:[{required:!0,message:"请选择过账日期",trigger:"change"}],postingUserId:[{required:!0,message:"请输入过账用户ID",trigger:"blur"}]}}},mounted(){this.loadJournalEntries(),this.loadData()},methods:{forEnText(e){for(let t of this.journalEntryList)if(t.id===e)return this.formatJournalEntryText(t);return""},async loadJournalEntries(){try{const e=await d();this.journalEntryList=e.data.records||[]}catch(e){console.error("获取会计分录列表失败:",e),this.$message.error("获取会计分录列表失败")}},formatJournalEntryText(e){return e?`${e.voucherNo} - ${e.voucherDate} - ${e.summary}`:""},async loadData(){this.loading=!0;try{const e=await n({...this.searchForm,pageNum:this.currentPage,pageSize:this.pageSize}),t=e.data||{};this.postingList=t.records||[],this.total=t.total||0}catch(e){this.$message.error("获取过账列表失败"),console.error("获取过账列表失败:",e)}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.loadData()},resetSearch(){this.searchForm={postingDate:"",entryId:null},this.loadData()},refreshData(){this.loadData()},handleAdd(){this.dialogTitle="新增过账",this.resetForm(),this.dialogVisible=!0},async handleEdit(e){try{this.formData={...e},this.dialogTitle="编辑过账",this.dialogVisible=!0}catch(t){this.$message.error("获取过账详情失败"),console.error("获取过账详情失败:",t)}},handleDelete(e){this.$confirm("确定要删除这条过账记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await l(e),this.$message.success("删除成功"),this.loadData()}catch(t){this.$message.error("删除失败"),console.error("删除过账失败:",t)}}).catch(()=>{})},async handleSubmit(){this.$refs.formRef.validate(async e=>{if(e)try{await i(this.formData),this.$message.success("保存成功"),this.dialogVisible=!1,this.loadData()}catch(t){this.$message.error("保存失败"),console.error("保存过账失败:",t)}})},resetForm(){this.$refs.formRef&&this.$refs.formRef.resetFields(),this.formData={id:null,entryId:null,postingDate:"",postingUserId:null}},formatDate(e,t){const a=e[t.property];return a?new Date(a).toLocaleDateString("zh-CN"):""},handleCurrentChange(e){this.currentPage=e,this.loadData()},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.loadData()}}},u=c,g=a(1656),h=(0,g.A)(u,r,s,!1,null,"7d7d75e8",null),p=h.exports},7277:function(e,t,a){var r=a(4373),s=a(5129),o=a(9143);const n=r.A.create({timeout:5e3});n.interceptors.request.use(e=>(s.A.state.token&&(e.headers["Authorization"]="Bearer "+s.A.state.token),e),e=>(console.log(e),Promise.reject(e))),n.interceptors.response.use(e=>{const t=e.data;return 200!==t.code?((0,o.Message)({message:t.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(t.message||"请求失败"))):t},e=>(e.response&&401===e.response.status&&(s.A.dispatch("logout"),location.reload()),(0,o.Message)({message:e.message||"网络异常",type:"error",duration:5e3}),Promise.reject(e))),t.A=n}}]);
//# sourceMappingURL=736.1e960fc2.js.map