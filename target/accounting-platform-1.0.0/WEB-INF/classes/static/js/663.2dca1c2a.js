"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[663],{7277:function(t,e,a){var r=a(4373),s=a(5129),o=a(9143);const l=r.A.create({timeout:5e3});l.interceptors.request.use(t=>(s.A.state.token&&(t.headers["Authorization"]="Bearer "+s.A.state.token),t),t=>(console.log(t),Promise.reject(t))),l.interceptors.response.use(t=>{const e=t.data;return 200!==e.code?((0,o.Message)({message:e.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(e.message||"请求失败"))):e},t=>(t.response&&401===t.response.status&&(s.A.dispatch("logout"),location.reload()),(0,o.Message)({message:t.message||"网络异常",type:"error",duration:5e3}),Promise.reject(t))),e.A=l},7663:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"journal-entry-container"},[e("div",{staticClass:"header"},[e("h2",[t._v("记账凭证")]),e("el-button",{attrs:{type:"primary"},on:{click:t.showAddDialog}},[t._v("新增凭证")])],1),e("div",{staticClass:"content"},[e("el-card",[e("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"凭证编号"}},[e("el-input",{attrs:{placeholder:"请输入凭证编号"},model:{value:t.searchForm.voucherNo,callback:function(e){t.$set(t.searchForm,"voucherNo",e)},expression:"searchForm.voucherNo"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),e("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.entryList}},[e("el-table-column",{attrs:{prop:"voucherNo",label:"凭证编号"}}),e("el-table-column",{attrs:{prop:"voucherDate",label:"凭证日期"}}),e("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),e("el-table-column",{attrs:{prop:"totalDebit",label:"借方总额"}}),e("el-table-column",{attrs:{prop:"totalCredit",label:"贷方总额"}}),e("el-table-column",{attrs:{prop:"status",label:"状态",formatter:t.formatStatus}}),e("el-table-column",{attrs:{label:"操作",width:"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[0===a.row.status?e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.editEntry(a.row)}}},[t._v("编辑")]):t._e(),0===a.row.status?e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.cancelEntry(a.row)}}},[t._v("取消")]):t._e()]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,total:t.total,layout:"total, prev, pager, next, jumper"},on:{"current-change":t.handleCurrentChange}})],1)],1)],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"80%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"entryFormRef",attrs:{model:t.entryForm,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"凭证日期"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date"},model:{value:t.entryForm.voucherDate,callback:function(e){t.$set(t.entryForm,"voucherDate",e)},expression:"entryForm.voucherDate"}})],1),e("el-form-item",{attrs:{label:"摘要"}},[e("el-input",{attrs:{placeholder:"请输入摘要"},model:{value:t.entryForm.summary,callback:function(e){t.$set(t.entryForm,"summary",e)},expression:"entryForm.summary"}})],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.entryDetails,border:""}},[e("el-table-column",{attrs:{prop:"subjectName",label:"会计科目"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择科目"},model:{value:a.row.subjectId,callback:function(e){t.$set(a.row,"subjectId",e)},expression:"scope.row.subjectId"}},t._l(t.subjectList,function(t){return e("el-option",{key:t.id,attrs:{label:`${t.code} - ${t.name}`,value:t.id}})}),1)]}}])}),e("el-table-column",{attrs:{label:"备注"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{attrs:{placeholder:"备注"},model:{value:a.row.remark,callback:function(e){t.$set(a.row,"remark",e)},expression:"scope.row.remark"}})]}}])}),e("el-table-column",{attrs:{label:"借方金额"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input-number",{attrs:{min:0},on:{change:t.updateTotal},model:{value:a.row.debitAmount,callback:function(e){t.$set(a.row,"debitAmount",e)},expression:"scope.row.debitAmount"}})]}}])}),e("el-table-column",{attrs:{label:"贷方金额"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input-number",{attrs:{min:0},on:{change:t.updateTotal},model:{value:a.row.creditAmount,callback:function(e){t.$set(a.row,"creditAmount",e)},expression:"scope.row.creditAmount"}})]}}])}),e("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.entryDetails.length>1?e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.removeDetail(a.$index)}}},[t._v("删除")]):t._e()]}}])})],1),e("div",{staticClass:"add-detail-btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.addDetail}},[t._v("新增分录")])],1),e("div",{staticClass:"total-section"},[e("div",{staticClass:"total-item"},[e("span",[t._v("合计：")]),e("span",[t._v("借方金额："+t._s(t.entryForm.totalDebit))]),e("span",[t._v("贷方金额："+t._s(t.entryForm.totalCredit))]),t.entryForm.totalDebit!==t.entryForm.totalCredit?e("span",{staticClass:"error-text"},[t._v("借贷不平")]):t._e()])])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",disabled:t.entryForm.totalDebit!==t.entryForm.totalCredit},on:{click:t.submitForm}},[t._v("保存")])],1)],1),e("el-dialog",{attrs:{title:"凭证详情",visible:t.detailVisible,width:"80%"},on:{"update:visible":function(e){t.detailVisible=e}}},[e("el-descriptions",{attrs:{column:1,border:""}},[e("el-descriptions-item",{attrs:{label:"凭证编号"}},[t._v(t._s(t.selectedEntry.voucherNo))]),e("el-descriptions-item",{attrs:{label:"凭证日期"}},[t._v(t._s(t.selectedEntry.voucherDate))]),e("el-descriptions-item",{attrs:{label:"摘要"}},[t._v(t._s(t.selectedEntry.summary))]),e("el-descriptions-item",{attrs:{label:"状态"}},[t._v(t._s(t.formatStatusText(t.selectedEntry.status)))])],1),e("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.selectedEntryDetails,border:""}},[e("el-table-column",{attrs:{prop:"subjectCode",label:"科目编码"}}),e("el-table-column",{attrs:{prop:"subjectName",label:"科目名称"}}),e("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e("el-table-column",{attrs:{prop:"debitAmount",label:"借方金额"}}),e("el-table-column",{attrs:{prop:"creditAmount",label:"贷方金额"}})],1),e("div",{staticClass:"total-section",staticStyle:{"margin-top":"10px"}},[e("div",{staticClass:"total-item"},[e("span",[t._v("合计：")]),e("span",[t._v("借方金额："+t._s(t.selectedEntry.totalDebit))]),e("span",[t._v("贷方金额："+t._s(t.selectedEntry.totalCredit))])])]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.detailVisible=!1}}},[t._v("关闭")])],1)],1)],1)},s=[],o=(a(4114),a(8111),a(7588),a(1701),a(7277)),l={name:"JournalEntry",data(){return{entryList:[],searchForm:{voucherNo:"",dateRange:[]},currentPage:1,pageSize:10,total:0,dialogVisible:!1,detailVisible:!1,dialogTitle:"新增凭证",entryForm:{id:"",voucherNo:"",voucherDate:"",summary:"",totalDebit:0,totalCredit:0,status:0},entryDetails:[],subjectList:[],selectedEntry:{},selectedEntryDetails:[]}},created(){this.loadSubjectList(),this.loadData()},methods:{async loadData(){try{const t=await o.A.get("/journal-entry/page",{params:{page:this.currentPage,pageSize:this.pageSize,voucherNo:this.searchForm.voucherNo}});200===t.code&&(this.entryList=t.data.records,this.total=t.data.total)}catch(t){this.$message.error("加载失败")}},async loadSubjectList(){try{const t=await o.A.get("/accounting-subject/tree");200===t.code&&(this.subjectList=t.data)}catch(t){this.$message.error("加载科目失败")}},search(){this.currentPage=1,this.loadData()},resetSearch(){this.searchForm={voucherNo:"",dateRange:[]},this.search()},handleCurrentChange(t){this.currentPage=t,this.loadData()},showAddDialog(){this.dialogTitle="新增凭证",this.resetForm(),this.dialogVisible=!0},editEntry(t){this.dialogTitle="编辑凭证",this.entryForm={...t},this.loadEntryDetails(t.id),this.dialogVisible=!0},async loadEntryDetails(t){try{const e=await o.A.get(`/journal-entry/detail/${t}`);200===e.code&&(this.entryDetails=e.data.map(t=>({id:t.id,subjectId:t.subjectId,debitAmount:t.debitAmount,creditAmount:t.creditAmount,remark:t.remark})))}catch(e){this.$message.error("加载明细失败")}},resetForm(){this.entryForm={id:"",voucherNo:"",voucherDate:new Date,summary:"",totalDebit:0,totalCredit:0,status:0},this.entryDetails=[this.createEmptyDetail()]},createEmptyDetail(){return{id:"",subjectId:"",debitAmount:0,creditAmount:0,remark:""}},addDetail(){this.entryDetails.push(this.createEmptyDetail())},removeDetail(t){this.entryDetails.splice(t,1),this.updateTotal()},updateTotal(){let t=0,e=0;this.entryDetails.forEach(a=>{t+=Number(a.debitAmount)||0,e+=Number(a.creditAmount)||0}),this.entryForm.totalDebit=t,this.entryForm.totalCredit=e},async submitForm(){try{const t={...this.entryForm,details:this.entryDetails};let e;e=t.id?await o.A.put("/journal-entry",t):await o.A.post("/journal-entry",t),200===e.code?(this.$message.success(e.message||"保存成功"),this.dialogVisible=!1,this.loadData()):this.$message.error(e.message||"保存失败")}catch(t){this.$message.error("保存失败")}},async viewDetail(t){try{const[e,a]=await Promise.all([o.A.get(`/journal-entry/${t.id}`),o.A.get(`/journal-entry/detail/${t.id}`)]);200===e.code&&200===a.code&&(this.selectedEntry=e.data,this.selectedEntryDetails=a.data,this.detailVisible=!0)}catch(e){this.$message.error("加载详情失败")}},async cancelEntry(t){this.$confirm("确定要取消该凭证吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await o.A.delete(`/journal-entry/${t.id}`);200===e.code?(this.$message.success("取消成功"),this.loadData()):this.$message.error(e.message||"取消失败")}catch(e){this.$message.error("取消失败")}}).catch(()=>{this.$message.info("已取消操作")})},formatStatus(t){const e={0:"未过账",1:"已过账",2:"已取消"};return e[t.status]||t.status},formatStatusText(t){const e={0:"未过账",1:"已过账",2:"已取消"};return e[t]||t}}},i=l,n=a(1656),c=(0,n.A)(i,r,s,!1,null,"3beae025",null),u=c.exports}}]);
//# sourceMappingURL=663.2dca1c2a.js.map