"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[487],{4487:function(t,e,r){r.r(e),r.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sales-order-container"},[e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("销售订单管理")]),e("el-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{type:"primary",size:"small"},on:{click:t.handleAdd}},[t._v("新增订单")])],1),e("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"订单编号"}},[e("el-input",{attrs:{placeholder:"请输入订单编号"},model:{value:t.searchForm.orderNumber,callback:function(e){t.$set(t.searchForm,"orderNumber",e)},expression:"searchForm.orderNumber"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{on:{click:t.handleReset}},[t._v("重置")])],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{prop:"orderNumber",label:"订单编号"}}),e("el-table-column",{attrs:{prop:"customerName",label:"客户名称"}}),e("el-table-column",{attrs:{prop:"totalAmount",label:"订单金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("currency")(e.row.totalAmount))+" ")]}}])}),e("el-table-column",{attrs:{prop:"status",label:"订单状态"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-tag",{attrs:{type:t.getStatusType(r.row.status)}},[t._v(" "+t._s(t.getStatusText(r.row.status))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"remark",label:"描述"}}),e("el-table-column",{attrs:{label:"操作",width:"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(r){return[0===r.row.status?e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleEdit(r.row)}}},[t._v("编辑")]):t._e(),0===r.row.status||3===r.row.status?e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.handleDelete(r.row.id)}}},[t._v("删除")]):t._e(),0===r.row.status?e("el-button",{attrs:{size:"small",type:"success"},on:{click:function(e){return t.handleApprove(r.row)}}},[t._v("审核")]):t._e()]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-size":t.pageSize,total:t.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"orderForm",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:"订单编号",prop:"orderNumber"}},[e("el-input",{attrs:{placeholder:"订单编号"},model:{value:t.form.orderNumber,callback:function(e){t.$set(t.form,"orderNumber",e)},expression:"form.orderNumber"}})],1)],1),e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:"客户",prop:"customerId"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择客户"},model:{value:t.form.customerId,callback:function(e){t.$set(t.form,"customerId",e)},expression:"form.customerId"}},t._l(t.customerList,function(t){return e("el-option",{key:t.id,attrs:{label:t.customerName,value:t.id}})}),1)],1)],1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:"订单金额",prop:"totalAmount"}},[e("el-input",{attrs:{placeholder:"请输入订单金额"},model:{value:t.form.totalAmount,callback:function(e){t.$set(t.form,"totalAmount",t._n(e))},expression:"form.totalAmount"}})],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:24}},[e("el-form-item",{attrs:{label:"描述",prop:"remark"}},[e("el-input",{attrs:{placeholder:"请输入订单描述",type:"textarea",rows:2},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleDialogCancel}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleFormSubmit}},[t._v("确定")])],1)],1),e("el-dialog",{attrs:{title:"审核销售订单",visible:t.approveDialogVisible,width:"80%"},on:{"update:visible":function(e){t.approveDialogVisible=e}}},[e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"订单编号"}},[t._v(t._s(t.approveForm.orderNumber))]),e("el-descriptions-item",{attrs:{label:"客户"}},[t.approveForm.customerName?e("span",[t._v(t._s(t.approveForm.customerName))]):e("span",[t._v("-")])]),e("el-descriptions-item",{attrs:{label:"订单金额"}},[t.approveForm.totalAmount?e("span",[t._v(t._s(t.formatCurrency(t.approveForm.totalAmount)))]):e("span",[t._v("-")])]),e("el-descriptions-item",{attrs:{label:"订单状态"}},[e("el-tag",{attrs:{type:t.getStatusType(t.approveForm.status)}},[t._v(t._s(t.getStatusText(t.approveForm.status)))])],1),e("el-descriptions-item",{attrs:{label:"订单日期",span:2}},[t.approveForm.orderDate?e("span",[t._v(t._s(t.formatDateTime(t.approveForm.orderDate)))]):e("span",[t._v("-")])]),e("el-descriptions-item",{attrs:{label:"描述",span:2}},[t.approveForm.remark?e("span",[t._v(t._s(t.approveForm.remark))]):e("span",[t._v("-")])])],1),e("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.approveDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"danger"},on:{click:t.handleReject}},[t._v("审批驳回")]),e("el-button",{attrs:{type:"success"},on:{click:t.handleApproveConfirm}},[t._v("审批通过")])],1)],1)],1)},s=[],o=(r(4114),r(8111),r(116),r(7588),r(412)),i={name:"SalesOrder",data(){return{searchForm:{orderNumber:"",customerName:"",orderStatus:""},tableData:[],currentPage:1,pageSize:10,total:0,selectedRows:[],dialogVisible:!1,dialogTitle:"",approveDialogVisible:!1,approveForm:{},form:{id:null,orderNumber:"",customerId:null,totalAmount:0,remark:"",status:0},rules:{orderNumber:[{required:!0,message:"订单编号不能为空",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"blur"}],totalAmount:[{required:!0,message:"请输入订单金额",trigger:"blur"},{type:"number",min:.01,message:"订单金额必须大于0",trigger:"blur"}],remark:[{required:!0,message:"请输入订单描述",trigger:"blur"}]},customerList:[],currentUser:{id:1,companyId:1}}},mounted(){this.loadSelectData().then(()=>{this.loadData()})},filters:{currency(t){return void 0===t||null===t?"0.00":parseFloat(t).toFixed(2)}},methods:{formatCurrency(t){return void 0===t||null===t?"0.00":parseFloat(t).toFixed(2)},formatDateTime(t){if(!t)return"-";const e=new Date(t),r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${r}-${a}-${s} ${o}:${i}:${l}`},loadData(){const t={pageNum:this.currentPage,pageSize:this.pageSize,...this.searchForm};o.j.page(t).then(t=>{200===t.code?(this.tableData=t.data.records,this.total=t.data.total,this.tableData.forEach(t=>{const e=this.customerList.find(e=>e.id===t.customerId);console.log(this.customerList),e&&(t.customerName=e.customerName)})):this.$message.error(t.message)}).catch(t=>{this.$message.error("加载数据失败")})},loadSelectData(){return o.xZ.getList().then(t=>{200===t.code&&(this.customerList=t.data)})},handleSearch(){this.currentPage=1,this.loadData()},handleReset(){this.searchForm={orderNumber:"",customerName:"",orderStatus:""},this.loadData()},handleSizeChange(t){this.pageSize=t,this.loadData()},handleCurrentChange(t){this.currentPage=t,this.loadData()},handleSelectionChange(t){this.selectedRows=t},getStatusType(t){switch(t){case 0:return"info";case 1:return"success";case 2:return"warning";case 3:return"danger";default:return"info"}},getStatusText(t){switch(t){case 0:return"待审核";case 1:return"已审核";case 2:return"已过账";case 3:return"已取消";default:return"未知"}},handleAdd(){this.dialogTitle="新增销售订单",this.form={id:null,orderNumber:"",customerId:null,totalAmount:0,remark:"",status:0},this.dialogVisible=!0},handleEdit(t){this.dialogTitle="编辑销售订单",this.form={...t},this.dialogVisible=!0},handleView(t){this.dialogTitle="查看销售订单",this.form={...t},this.dialogVisible=!0},handleDelete(t){this.$confirm("确定要删除该销售订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.j.delete(t).then(t=>{200===t.code?(this.$message.success("删除成功"),this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("删除失败")})})},handleSubmit(t){this.$confirm("确定要提交审核该销售订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.j.submit(t).then(t=>{200===t.code?(this.$message.success("提交审核成功"),this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("提交审核失败")})})},handleApprove(t){o.j.getById(t.id).then(t=>{if(200===t.code){const e=t.data.order||t.data;this.approveForm={...e};const r=this.customerList.find(t=>t.id===this.approveForm.customerId);r&&(this.approveForm.customerName=r.customerName),this.approveDialogVisible=!0}else this.$message.error(t.message||"获取订单详情失败")}).catch(t=>{console.error("获取订单详情错误:",t),this.$message.error("获取订单详情失败："+(t.response?.data?.message||t.message||"未知错误"))})},handleApproveConfirm(){this.$confirm("确定要审批通过该销售订单吗？审核通过后将自动生成凭证和税务记录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.j.approve(this.approveForm.id,this.currentUser.id).then(t=>{200===t.code?(this.$message.success("审批通过，已自动生成凭证和税务记录"),this.approveDialogVisible=!1,this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("审批失败："+(t.response?.data?.message||t.message))})})},handleReject(){this.$confirm("确定要驳回该销售订单吗？驳回后订单状态将变为已取消","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.j.cancel(this.approveForm.id,this.currentUser.id).then(t=>{200===t.code?(this.$message.success("审批驳回成功，订单已取消"),this.approveDialogVisible=!1,this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("审批驳回失败："+(t.response?.data?.message||t.message))})})},handleCancel(t){this.$confirm("确定要取消该销售订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.j.cancel(t).then(t=>{200===t.code?(this.$message.success("取消订单成功"),this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("取消订单失败")})})},handleDialogCancel(){this.dialogVisible=!1,this.$nextTick(()=>{this.$refs.orderForm&&this.$refs.orderForm.resetFields()})},handleFormSubmit(){this.$refs.orderForm.validate(t=>{t&&(this.form.id?o.j.update(this.form).then(t=>{200===t.code?(this.$message.success("更新成功"),this.dialogVisible=!1,this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("更新失败")}):o.j.add(this.form).then(t=>{200===t.code?(this.$message.success("新增成功"),this.dialogVisible=!1,this.loadData()):this.$message.error(t.message)}).catch(t=>{this.$message.error("新增失败")}))})},handleAddItem(){this.form.items.push({id:null,productId:null,productCode:"",productName:"",unit:"",quantity:1,unitPrice:0,taxRate:13,totalAmount:0,taxtotalAmount:0})},handleDeleteItem(t){this.form.items.splice(t,1),this.calculateTotal()},onCustomerChange(){const t=this.customerList.find(t=>t.id===this.form.customerId);t&&(this.form.customerName=t.customerName,this.form.customerContact=t.contactPerson,this.form.customerPhone=t.contactPhone,this.form.customerAddress=t.address)},onProductChange(t,e){const r=this.productList.find(e=>e.id===t.productId);r&&(t.productCode=r.productCode,t.productName=r.productName,t.unit=r.unit,t.unitPrice=r.salesPrice||0,this.calculateItemtotalAmount(e))},calculateItemtotalAmount(t){const e=this.form.items[t];e.quantity&&e.unitPrice?(e.totalAmount=(e.quantity*e.unitPrice).toFixed(2),e.taxtotalAmount=(e.totalAmount*(e.taxRate/100)).toFixed(2)):(e.totalAmount=0,e.taxtotalAmount=0),this.calculateTotal()},calculateTotal(){let t=0,e=0;this.form.items.forEach(r=>{t+=parseFloat(r.totalAmount||0),e+=parseFloat(r.taxtotalAmount||0)}),this.form.totaltotalAmount=t.toFixed(2),this.form.taxtotalAmount=e.toFixed(2)},getToday(){const t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${a}`}}},l=i,n=r(1656),c=(0,n.A)(l,a,s,!1,null,"780933b4",null),m=c.exports}}]);
//# sourceMappingURL=487.c679dcba.js.map