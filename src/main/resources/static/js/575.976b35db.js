"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[575],{2575:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"accounting-subject-container"},[t("div",{staticClass:"header"},[t("h2",[e._v("会计科目管理")]),t("el-button",{attrs:{type:"primary"},on:{click:e.showAddDialog}},[e._v("新增科目")])],1),t("div",{staticClass:"content"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"tree-card"},[t("div",{staticClass:"tree-header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("科目树")]),t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"搜索科目",size:"small","prefix-icon":"el-icon-search",clearable:""},on:{input:e.handleFilter},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("div",{staticClass:"tree-wrapper"},[t("el-tree",{ref:"subjectTreeRef",attrs:{data:e.filteredTree,props:e.defaultProps,"node-key":"id","default-expand-all":!1,"expand-on-click-node":!1,"filter-node-method":e.filterNode,"highlight-current":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:s,data:i}){return[t("span",{staticClass:"custom-tree-node"},[t("span",{staticClass:"node-label"},[t("span",{staticClass:"node-code"},[e._v(e._s(i.code))]),t("span",{staticClass:"node-name"},[e._v(e._s(i.name))])]),t("span",{staticClass:"node-tags"},[i.businessType?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v(" "+e._s(e.getBusinessTypeText(i.businessType))+" ")]):e._e(),1===i.status?t("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("启用")]):t("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("禁用")])],1)])]}}])})],1)])],1),t("el-col",{attrs:{span:16}},[e.selectedSubject?t("el-card",{staticClass:"detail-card"},[t("div",{staticClass:"detail-header",attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"detail-title"},[e._v("科目详情")]),t("div",{staticClass:"detail-actions"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit"},on:{click:e.showEditDialog}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:e.deleteSubject}},[e._v("删除")]),t("el-button",{attrs:{size:"small",icon:1===e.selectedSubject.status?"el-icon-close":"el-icon-check"},on:{click:e.toggleEnable}},[e._v(" "+e._s(1===e.selectedSubject.status?"禁用":"启用")+" ")]),t("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-link"},on:{click:e.showBindDialog}},[e._v("绑定业务")])],1)]),t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"科目编码"}},[e._v(e._s(e.selectedSubject.code))]),t("el-descriptions-item",{attrs:{label:"科目名称"}},[e._v(e._s(e.selectedSubject.name))]),t("el-descriptions-item",{attrs:{label:"科目类型"}},[e._v(e._s(this.getTypeText(e.selectedSubject.type)))]),t("el-descriptions-item",{attrs:{label:"余额方向"}},[e._v(e._s(1===e.selectedSubject.balanceDirection?"借":"贷"))]),t("el-descriptions-item",{attrs:{label:"状态"}},[e._v(e._s(1===e.selectedSubject.status?"启用":"禁用"))]),t("el-descriptions-item",{attrs:{label:"业务绑定"}},[e.selectedSubject.businessType?t("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.getBusinessTypeText(e.selectedSubject.businessType)))]):t("el-tag",{attrs:{type:"info"}},[e._v("未绑定")]),e.selectedSubject.businessType?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"small"},on:{click:e.unbindBusiness}},[e._v("取消绑定")]):e._e()],1)],1)],1):t("el-empty",{attrs:{description:"请选择一个科目查看详情"}})],1)],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"subjectFormRef",attrs:{model:e.subjectForm,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"科目编码",prop:"code"}},[t("el-input",{attrs:{placeholder:"请输入科目编码"},model:{value:e.subjectForm.code,callback:function(t){e.$set(e.subjectForm,"code",t)},expression:"subjectForm.code"}})],1),t("el-form-item",{attrs:{label:"科目名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入科目名称"},model:{value:e.subjectForm.name,callback:function(t){e.$set(e.subjectForm,"name",t)},expression:"subjectForm.name"}})],1),t("el-form-item",{attrs:{label:"科目类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择科目类型"},model:{value:e.subjectForm.type,callback:function(t){e.$set(e.subjectForm,"type",t)},expression:"subjectForm.type"}},[t("el-option",{attrs:{label:"资产",value:1}}),t("el-option",{attrs:{label:"负债",value:2}}),t("el-option",{attrs:{label:"共同",value:3}}),t("el-option",{attrs:{label:"所有者权益",value:4}}),t("el-option",{attrs:{label:"成本",value:5}}),t("el-option",{attrs:{label:"损益",value:6}})],1)],1),t("el-form-item",{attrs:{label:"余额方向",prop:"balanceDirection"}},[t("el-radio-group",{model:{value:e.subjectForm.balanceDirection,callback:function(t){e.$set(e.subjectForm,"balanceDirection",t)},expression:"subjectForm.balanceDirection"}},[t("el-radio",{attrs:{label:1}},[e._v("借")]),t("el-radio",{attrs:{label:2}},[e._v("贷")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"绑定业务类型",visible:e.bindDialogVisible,width:"500px"},on:{"update:visible":function(t){e.bindDialogVisible=t}}},[t("el-form",{attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"业务类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务类型"},model:{value:e.bindBusinessType,callback:function(t){e.bindBusinessType=t},expression:"bindBusinessType"}},[t("el-option",{attrs:{label:"采购单",value:"PURCHASE"}}),t("el-option",{attrs:{label:"销售单",value:"SALES"}}),t("el-option",{attrs:{label:"员工费用",value:"EXPENSE"}}),t("el-option",{attrs:{label:"税务处理",value:"TAX"}})],1)],1),e.existingBindInfo?t("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"该业务类型已绑定到："+e.existingBindInfo,type:"warning",closable:!1}}):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.bindDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmBind}},[e._v("确定")])],1)],1)],1)},a=[],l=(s(8111),s(2489),s(7277)),o=s(412),c={name:"AccountingSubject",data(){return{subjectTree:[],filteredTree:[],filterText:"",selectedSubject:null,dialogVisible:!1,isAddDialog:!0,dialogTitle:"新增科目",bindDialogVisible:!1,bindBusinessType:"",existingBindInfo:"",subjectForm:{code:"",name:"",type:"",balanceDirection:"1",parentId:0,status:1},defaultProps:{children:"children",label:e=>`${e.code} - ${e.name}`},rules:{code:[{required:!0,message:"请输入科目编码",trigger:"blur"}],name:[{required:!0,message:"请输入科目名称",trigger:"blur"}],type:[{required:!0,message:"请选择科目类型",trigger:"change"}],balanceDirection:[{required:!0,message:"请选择余额方向",trigger:"change"}]}}},computed:{isAddDialog(){return!this.subjectForm.id}},created(){this.loadSubjectTree()},methods:{async loadSubjectTree(){try{const e=await l.A.get("/accounting-subject/tree");200===e.code&&this.buildTreeData(e.data)}catch(e){this.$message.error("加载科目树失败")}},buildTreeData(e){this.subjectTree=e,this.filteredTree=e},handleFilter(e){this.$refs.subjectTreeRef.filter(e)},filterNode(e,t){return!e||(t.code.toLowerCase().includes(e.toLowerCase())||t.name.toLowerCase().includes(e.toLowerCase()))},getTypeText(e){const t={1:"资产",2:"负债",3:"共同",4:"所有者权益",5:"成本",6:"损益"};return t[e]||e},handleNodeClick(e){this.selectedSubject=e},showAddDialog(){this.dialogTitle="新增科目",this.resetForm(),this.dialogVisible=!0},showEditDialog(){this.dialogTitle="编辑科目",this.subjectForm={...this.selectedSubject},this.dialogVisible=!0},resetForm(){this.subjectForm={code:"",name:"",type:"",balanceDirection:"1",parentId:0,status:1},this.$refs.subjectFormRef&&this.$refs.subjectFormRef.resetFields()},async submitForm(){this.$refs.subjectFormRef.validate(async e=>{if(e)try{let e;this.subjectForm.id?(e=await l.A.put("/accounting-subject/update",this.subjectForm),this.selectedSubject=this.subjectForm):e=await l.A.post("/accounting-subject/add",this.subjectForm),200===e.code?(this.$message.success(e.message||(this.isAddDialog?"新增成功":"更新成功")),this.dialogVisible=!1,await this.loadSubjectTree(),!this.isAddDialog&&this.selectedSubject&&this.$nextTick(()=>{this.$refs.subjectTreeRef.setCurrentKey(this.selectedSubject.id)})):this.$message.error(e.message||(this.isAddDialog?"新增失败":"更新失败"))}catch(t){this.$message.error(this.isAddDialog?"新增失败":"更新失败")}})},async deleteSubject(){this.$confirm("确定要删除这个科目吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await l.A.delete(`/accounting-subject/delete/${this.selectedSubject.id}`);200===e.code?(this.$message.success("删除成功"),this.loadSubjectTree(),this.selectedSubject=null):this.$message.error(e.message||"删除失败")}catch(e){this.$message.error("删除失败")}}).catch(()=>{this.$message.info("已取消删除")})},async toggleEnable(){const e=1===this.selectedSubject.status?0:1;try{const t=await l.A.put(`/accounting-subject/enable/${this.selectedSubject.id}?enabled=${e}`);200===t.code?(this.$message.success(1===e?"启用成功":"禁用成功"),this.selectedSubject.status=e):this.$message.error(t.message||"操作失败")}catch(t){this.$message.error("操作失败")}},async showBindDialog(){if(this.bindBusinessType=this.selectedSubject.businessType||"",this.existingBindInfo="",this.bindBusinessType)try{const e=await l.A.get(`/accounting-subject/getByBusinessType/${this.bindBusinessType}`);200===e.code&&e.data&&e.data.id!==this.selectedSubject.id&&(this.existingBindInfo=e.data.code+"-"+e.data.name)}catch(e){}this.bindDialogVisible=!0},async confirmBind(){if(this.bindBusinessType)try{const e=await o.tA.getByBusinessType(this.bindBusinessType);200===e.code&&e.data&&e.data.id!==this.selectedSubject.id?this.$confirm(`该业务类型已绑定到科目：${e.data.code}-${e.data.name}，是否继续绑定？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.doBind()}):this.doBind()}catch(e){this.doBind()}else this.$message.warning("请选择业务类型")},async doBind(){try{const e=await o.tA.bindBusinessType(this.selectedSubject.id,this.bindBusinessType);200===e.code?(this.$message.success("绑定成功"),this.bindDialogVisible=!1,this.loadSubjectTree(),this.selectedSubject.businessType=this.bindBusinessType):this.$message.error(e.message||"绑定失败")}catch(e){this.$message.error(e.response?.data?.message||"绑定失败")}},async unbindBusiness(){this.$confirm("确定要取消绑定吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await o.tA.unbindBusinessType(this.selectedSubject.id);200===e.code?(this.$message.success("取消绑定成功"),this.selectedSubject.businessType=null,this.loadSubjectTree()):this.$message.error(e.message||"取消绑定失败")}catch(e){this.$message.error("取消绑定失败")}})},getBusinessTypeText(e){const t={PURCHASE:"采购单",SALES:"销售单",EXPENSE:"员工费用",TAX:"税务处理"};return t[e]||e}}},n=c,r=s(1656),d=(0,r.A)(n,i,a,!1,null,"596270d8",null),u=d.exports},7277:function(e,t,s){var i=s(4373),a=s(5129),l=s(9143);const o=i.A.create({timeout:5e3});o.interceptors.request.use(e=>(a.A.state.token&&(e.headers["Authorization"]="Bearer "+a.A.state.token),e),e=>(console.log(e),Promise.reject(e))),o.interceptors.response.use(e=>{const t=e.data;return 200!==t.code?((0,l.Message)({message:t.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(t.message||"请求失败"))):t},e=>(e.response&&401===e.response.status&&(a.A.dispatch("logout"),location.reload()),(0,l.Message)({message:e.message||"网络异常",type:"error",duration:5e3}),Promise.reject(e))),t.A=o}}]);
//# sourceMappingURL=575.976b35db.js.map