"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[289],{289:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"posting-container"},[e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("过账管理")])]),e("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.searchForm}},[e("el-form-item",{attrs:{label:"会计分录ID"}},[e("el-select",{attrs:{placeholder:"请选择会计分录"},model:{value:t.searchForm.entryId,callback:function(e){t.$set(t.searchForm,"entryId",e)},expression:"searchForm.entryId"}},t._l(t.journalEntryList,function(a){return e("el-option",{key:a.id,attrs:{label:t.formatJournalEntryText(a),value:a.id}})}),1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.postingList}},[e("el-table-column",{attrs:{prop:"entryId",label:"会计分录"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.forEnText(e.row.entryId))+" ")]}}])}),e("el-table-column",{attrs:{prop:"businessSourceInfo",label:"来源信息",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.businessSourceInfo?e("el-tag",{attrs:{type:"info",size:"small"}},[t._v(" "+t._s(a.row.businessSourceInfo)+" ")]):e("span",{staticStyle:{color:"#909399"}},[t._v("-")])]}}])}),e("el-table-column",{attrs:{prop:"postingDate",label:"过账日期",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDateTime(e.row.postingDate))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"info",size:"small"},on:{click:function(e){return t.handleView(a.row)}}},[t._v("查看")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"",layout:"prev, pager, next, jumper, total",total:t.total,"current-page":t.currentPage,"page-size":t.pageSize},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)],1),e("el-dialog",{attrs:{title:"过账详情",visible:t.viewDialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(e){t.viewDialogVisible=e}}},[t.viewData?e("div",[e("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("过账基本信息")])]),e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"过账日期"}},[t._v(t._s(t.formatDateTime(t.viewData.posting?.postingDate)))]),e("el-descriptions-item",{attrs:{label:"过账说明"}},[t._v(t._s(t.viewData.posting?.remark||"-"))]),e("el-descriptions-item",{attrs:{label:"业务来源",span:2}},[t.viewData.businessSourceInfo?e("el-tag",{attrs:{type:"info"}},[t._v(" "+t._s(t.viewData.businessSourceInfo)+" ")]):e("span",{staticStyle:{color:"#909399"}},[t._v("-")])],1)],1)],1),t.viewData.journalEntry?e("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("凭证信息")])]),e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"凭证编号"}},[t._v(t._s(t.viewData.journalEntry?.voucherNo||"-"))]),e("el-descriptions-item",{attrs:{label:"凭证日期"}},[t._v(t._s(t.formatDate(t.viewData.journalEntry?.voucherDate)))]),e("el-descriptions-item",{attrs:{label:"摘要",span:2}},[t._v(t._s(t.viewData.journalEntry?.summary||"-"))]),e("el-descriptions-item",{attrs:{label:"借方总额"}},[t._v(t._s(t.formatMoney(t.viewData.journalEntry?.totalDebit)))]),e("el-descriptions-item",{attrs:{label:"贷方总额"}},[t._v(t._s(t.formatMoney(t.viewData.journalEntry?.totalCredit)))]),e("el-descriptions-item",{attrs:{label:"状态"}},[e("el-tag",{attrs:{type:1===t.viewData.journalEntry?.status?"success":"warning"}},[t._v(" "+t._s(1===t.viewData.journalEntry?.status?"已过账":"未过账")+" ")])],1),e("el-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.formatDateTime(t.viewData.journalEntry?.createTime)))])],1)],1):t._e(),t.viewData.entryDetails&&t.viewData.entryDetails.length>0?e("el-card",{attrs:{shadow:"never"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("凭证明细（共 "+t._s(t.viewData.entryDetails.length)+" 笔）")])]),e("el-table",{attrs:{data:t.viewData.entryDetails,border:"",stripe:"","max-height":"400"}},[e("el-table-column",{attrs:{prop:"subjectCode",label:"科目编码",width:"120"}}),e("el-table-column",{attrs:{prop:"subjectName",label:"科目名称",width:"180"}}),e("el-table-column",{attrs:{prop:"debitAmount",label:"借方金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatMoney(e.row.debitAmount))+" ")]}}],null,!1,3029429181)}),e("el-table-column",{attrs:{prop:"creditAmount",label:"贷方金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatMoney(e.row.creditAmount))+" ")]}}],null,!1,2040855630)}),e("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}})],1)],1):e("el-card",{attrs:{shadow:"never"}},[e("div",{staticStyle:{"text-align":"center",color:"#909399",padding:"20px"}},[t._v(" 暂无凭证明细 ")])])],1):t._e(),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.viewDialogVisible=!1}}},[t._v("关闭")])],1)])],1)},s=[],o=a(7277);function n(t){return(0,o.A)({url:"/posting/page",method:"get",params:t})}function i(t){return(0,o.A)({url:`/posting/detail/${t}`,method:"get"})}function l(t={}){return(0,o.A)({url:"/journal-entry/page",method:"get",params:{pageNum:t.pageNum||1,pageSize:t.pageSize||100,...t}})}var c={name:"Posting",data(){return{loading:!1,postingList:[],journalEntryList:[],searchForm:{postingDate:"",entryId:null},formRef:null,total:0,currentPage:1,pageSize:10,viewDialogVisible:!1,viewData:null}},mounted(){this.loadJournalEntries(),this.loadData()},methods:{forEnText(t){for(let e of this.journalEntryList)if(e.id===t)return this.formatJournalEntryText(e);return""},async loadJournalEntries(){try{const t=await l();this.journalEntryList=t.data.records||[]}catch(t){console.error("获取会计分录列表失败:",t),this.$message.error("获取会计分录列表失败")}},formatJournalEntryText(t){return t?`${t.voucherNo} - ${t.voucherDate} - ${t.summary}`:""},formatDateTime(t){if(!t)return"-";const e=new Date(t),a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return`${a}-${r}-${s} ${o}:${n}:${i}`},async loadData(){this.loading=!0;try{const t=await n({...this.searchForm,pageNum:this.currentPage,pageSize:this.pageSize}),e=t.data||{};this.postingList=e.records||[],this.total=e.total||0}catch(t){this.$message.error("获取过账列表失败"),console.error("获取过账列表失败:",t)}finally{this.loading=!1}},handleSearch(){this.currentPage=1,this.loadData()},resetSearch(){this.searchForm={postingDate:"",entryId:null},this.loadData()},refreshData(){this.loadData()},async handleView(t){try{const e=await i(t.id),a=e.data||e;200===a.code||200===e.code?(this.viewData=a.data||a,this.viewDialogVisible=!0):this.$message.error(a.message||e.message||"获取过账详情失败")}catch(e){console.error("获取过账详情失败:",e),this.$message.error("获取过账详情失败："+(e.response?.data?.message||e.message))}},formatMoney(t){return t||0===t?Number(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatDate(t){if(!t)return"-";try{const e=new Date(t);if(isNaN(e.getTime()))return"-";const a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${a}-${r}-${s}`}catch(e){return"-"}},handleCurrentChange(t){this.currentPage=t,this.loadData()},handleSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadData()}}},u=c,d=a(1656),g=(0,d.A)(u,r,s,!1,null,"17a7442a",null),m=g.exports},7277:function(t,e,a){var r=a(4373),s=a(5129),o=a(9143);const n=r.A.create({timeout:5e3});n.interceptors.request.use(t=>(s.A.state.token&&(t.headers["Authorization"]="Bearer "+s.A.state.token),t),t=>(console.log(t),Promise.reject(t))),n.interceptors.response.use(t=>{const e=t.data;return 200!==e.code?((0,o.Message)({message:e.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(e.message||"请求失败"))):e},t=>(t.response&&401===t.response.status&&(s.A.dispatch("logout"),location.reload()),(0,o.Message)({message:t.message||"网络异常",type:"error",duration:5e3}),Promise.reject(t))),e.A=n}}]);
//# sourceMappingURL=289.599680a1.js.map