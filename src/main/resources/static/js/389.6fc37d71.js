"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[389],{3389:function(e,a,t){t.r(a),t.d(a,{default:function(){return p}});var s=function(){var e=this,a=e._self._c;return a("el-card",{staticClass:"regular-business-container"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("定期业务处理")]),a("el-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.handleAddBusiness}},[e._v("新增业务")])],1),a("div",{staticClass:"search-container"},[a("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[a("el-form-item",{attrs:{label:"业务类型："}},[a("el-select",{attrs:{placeholder:"请选择业务类型"},model:{value:e.searchForm.businessType,callback:function(a){e.$set(e.searchForm,"businessType",a)},expression:"searchForm.businessType"}},[a("el-option",{attrs:{label:"计提折旧",value:"depreciation"}}),a("el-option",{attrs:{label:"计提工资",value:"salary"}}),a("el-option",{attrs:{label:"计提税费",value:"tax_provision"}}),a("el-option",{attrs:{label:"分摊费用",value:"expense_allocation"}})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("el-button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1)],1),a("div",{staticClass:"table-container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.businessList}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),a("el-table-column",{attrs:{prop:"businessType",label:"业务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getTypeName(t.row.businessType)))])]}}])}),a("el-table-column",{attrs:{prop:"businessDate",label:"业务日期"}}),a("el-table-column",{attrs:{prop:"amount",label:"金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("¥"+e._s(t.row.amount||0))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"业务状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleToggleStatus(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),a("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.pageInfo.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"700px","close-on-click-modal":!1},on:{"update:visible":function(a){e.dialogVisible=a}}},[a("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[a("el-select",{attrs:{placeholder:"请选择业务类型",disabled:"view"===e.dialogMode},model:{value:e.formData.businessType,callback:function(a){e.$set(e.formData,"businessType",a)},expression:"formData.businessType"}},[a("el-option",{attrs:{label:"计提折旧",value:"depreciation"}}),a("el-option",{attrs:{label:"计提工资",value:"salary"}}),a("el-option",{attrs:{label:"计提税费",value:"tax_provision"}}),a("el-option",{attrs:{label:"分摊费用",value:"expense_allocation"}})],1)],1),a("el-form-item",{attrs:{label:"业务日期",prop:"businessDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd",disabled:"view"===e.dialogMode},model:{value:e.formData.businessDate,callback:function(a){e.$set(e.formData,"businessDate",a)},expression:"formData.businessDate"}})],1),a("el-form-item",{attrs:{label:"金额",prop:"amount"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:.01,placeholder:"请输入金额",disabled:"view"===e.dialogMode},model:{value:e.formData.amount,callback:function(a){e.$set(e.formData,"amount",a)},expression:"formData.amount"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入备注信息",disabled:"view"===e.dialogMode},model:{value:e.formData.remark,callback:function(a){e.$set(e.formData,"remark",a)},expression:"formData.remark"}})],1),"view"!==e.dialogMode?a("el-form-item",{attrs:{label:"初始状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.status,callback:function(a){e.$set(e.formData,"status",a)},expression:"formData.status"}})],1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(a){e.dialogVisible=!1}}},[e._v("取消")]),"view"!==e.dialogMode?a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")]):e._e()],1)],1)],1)},i=[],l=t(4373),r=t(412);const o={page:e=>(0,r.Ay)({url:"/regular-business/page",method:"get",params:e}),getList:e=>{const a={};return e.businessType&&(a.businessType=e.businessType),e.businessDate&&(a.businessDate=e.businessDate),e.status&&(a.status=e.status),e.page&&(a.page=e.page),e.pageSize&&(a.pageSize=e.pageSize),l.A.get("/regular-business",{params:a})},getById:e=>l.A.get(`/regular-business/${e}`),save:e=>{const a={id:e.id,businessType:e.businessType,businessDate:e.businessDate,amount:e.amount,status:e.status,remark:e.remark};return e.id?l.A.put("/regular-business",a):l.A.post("/regular-business",a)},updateStatus:(e,a)=>l.A.put("/regular-business",{id:e,status:a}),process:e=>l.A.post("/regular-business/process",{id:e}),delete:e=>l.A.delete(`/regular-business/${e}`)};var n={name:"RegularBusiness",data(){return{loading:!1,businessList:[],searchForm:{businessType:"",businessDate:"",status:""},pageInfo:{currentPage:1,pageSize:10,total:0},dialogVisible:!1,dialogMode:"add",dialogTitle:"新增定期业务",formData:{id:"",businessType:"",businessDate:"",amount:null,status:"1",remark:""},rules:{businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],businessDate:[{required:!0,message:"请选择业务日期",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}]}}},created(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const e={pageNum:this.pageInfo.currentPage,pageSize:this.pageInfo.pageSize,...this.searchForm},a=await o.page(e);this.businessList=a.data.records,this.pageInfo.total=a.data.total}catch(e){this.$message.error("获取定期业务列表失败: "+(e.response?.data?.message||e.message))}finally{this.loading=!1}},handleSearch(){this.pageInfo.currentPage=1,this.loadData()},handleReset(){this.searchForm={businessType:"",businessDate:"",status:""},this.pageInfo.currentPage=1,this.loadData()},handleSizeChange(e){this.pageInfo.pageSize=e,this.loadData()},handleCurrentChange(e){this.pageInfo.currentPage=e,this.loadData()},handleAddBusiness(){this.dialogMode="add",this.dialogTitle="新增定期业务",this.resetForm(),this.dialogVisible=!0},async handleView(e){this.dialogMode="view",this.dialogTitle="查看定期业务";try{const a=await o.getById(e.id);this.formData={...a.data.data},this.dialogVisible=!0}catch(a){this.$message.error("获取业务详情失败: "+(a.response?.data?.message||a.message))}},async handleEdit(e){this.dialogMode="edit",this.dialogTitle="编辑定期业务";try{const a=await o.getById(e.id);this.formData={...a.data.data},this.dialogVisible=!0}catch(a){this.$message.error("获取业务详情失败: "+(a.response?.data?.message||a.message))}},async handleSubmit(){this.$refs.formRef.validate(async e=>{if(e)try{const e={...this.formData,status:parseInt(this.formData.status)};await o.save(e),this.$message.success("add"===this.dialogMode?"新增成功":"编辑成功"),this.dialogVisible=!1,this.loadData()}catch(a){this.$message.error("保存失败: "+(a.response?.data?.message||a.message))}})},resetForm(){this.$refs.formRef&&this.$refs.formRef.resetFields(),this.formData={id:"",businessType:"",businessDate:"",amount:null,status:"1",remark:""}},handleToggleStatus(e){const a="1"===e.status?"0":"1";this.$confirm(`确定要${"1"===a?"启用":"禁用"}该定期业务吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await o.updateStatus(e.id,parseInt(a)),this.$message.success("业务已"+("1"===a?"启用":"禁用"))}catch(t){e.status="1"===e.status?"0":"1",this.$message.error("状态更新失败: "+(t.response?.data?.message||t.message))}}).catch(()=>{e.status="1"===e.status?"0":"1",this.$message.info("已取消操作")})},handleManualExecute(){const e=this.$refs.table?.selection||[];e&&0!==e.length?this.$confirm(`确定要立即执行选中的${e.length}个定期业务吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.loading=!0;for(const a of e)await o.process(a.id);this.$message.success(`成功执行${e.length}个定期业务`),this.loadData()}catch(a){this.$message.error("批量执行失败: "+(a.response?.data?.message||a.message))}finally{this.loading=!1}}).catch(()=>{this.$message.info("已取消操作")}):this.$message.warning("请选择要执行的定期业务")},getTypeName(e){const a={depreciation:"计提折旧",salary:"计提工资",tax_provision:"计提税费",expense_allocation:"分摊费用"};return a[e]||e}}},u=n,d=t(1656),c=(0,d.A)(u,s,i,!1,null,"ff715f0a",null),p=c.exports}}]);
//# sourceMappingURL=389.6fc37d71.js.map