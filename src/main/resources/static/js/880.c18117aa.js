"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[880],{7277:function(e,t,a){var o=a(4373),i=a(5129),s=a(9143);const l=o.A.create({timeout:5e3});l.interceptors.request.use(e=>(i.A.state.token&&(e.headers["Authorization"]="Bearer "+i.A.state.token),e),e=>(console.log(e),Promise.reject(e))),l.interceptors.response.use(e=>{const t=e.data;return 200!==t.code?((0,s.Message)({message:t.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(t.message||"请求失败"))):t},e=>(e.response&&401===e.response.status&&(i.A.dispatch("logout"),location.reload()),(0,s.Message)({message:e.message||"网络异常",type:"error",duration:5e3}),Promise.reject(e))),t.A=l},7880:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"reconciliation-container"},[t("el-card",[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("对账管理")]),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.showAutoReconcileDialog}},[e._v("对账")])],1)]),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"科目"}},[t("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择科目",filterable:"",clearable:""},model:{value:e.searchForm.accountId,callback:function(t){e.$set(e.searchForm,"accountId",t)},expression:"searchForm.accountId"}},e._l(e.subjectList,function(e){return t("el-option",{key:e.id,attrs:{label:e.code+" - "+e.name,value:e.id.toString()}})}),1)],1),t("el-form-item",{attrs:{label:"对账日期"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择对账日期","value-format":"yyyy-MM-dd",clearable:""},model:{value:e.searchForm.reconciliationDate,callback:function(t){e.$set(e.searchForm,"reconciliationDate",t)},expression:"searchForm.reconciliationDate"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"请选择状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"未对账",value:0}}),t("el-option",{attrs:{label:"已对账",value:1}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.reconciliationList}},[t("el-table-column",{attrs:{prop:"accountId",label:"科目ID",width:"100"}}),t("el-table-column",{attrs:{label:"科目名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.getSubjectName(a.row.accountId)?t("span",[e._v(e._s(e.getSubjectName(a.row.accountId)))]):t("span",{staticStyle:{color:"#909399"}},[e._v("-")])]}}])}),t("el-table-column",{attrs:{prop:"reconciliationDate",label:"对账日期"}}),t("el-table-column",{attrs:{prop:"bookBalance",label:"账面余额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatMoney(t.row.bookBalance))+" ")]}}])}),t("el-table-column",{attrs:{prop:"statementBalance",label:"对账单余额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatMoney(t.row.statementBalance))+" ")]}}])}),t("el-table-column",{attrs:{prop:"difference",label:"差额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatMoney(t.row.difference))+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getStatusType(a.row.status)}},[e._v(e._s(e.getStatusText(a.row.status)))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return e.handleView(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo.total,"current-page":e.pageInfo.pageNum,"page-size":e.pageInfo.pageSize,"page-sizes":[10,20,50,100]},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),t("el-dialog",{attrs:{title:"对账",visible:e.autoReconcileDialogVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.autoReconcileDialogVisible=t}}},[t("el-form",{ref:"autoReconcileForm",attrs:{model:e.autoReconcileForm,rules:e.autoReconcileRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"会计科目",prop:"subjectId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择会计科目",filterable:""},model:{value:e.autoReconcileForm.subjectId,callback:function(t){e.$set(e.autoReconcileForm,"subjectId",t)},expression:"autoReconcileForm.subjectId"}},e._l(e.subjectList,function(e){return t("el-option",{key:e.id,attrs:{label:e.code+" - "+e.name,value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:"对账日期",prop:"reconciliationDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择对账日期","value-format":"yyyy-MM-dd"},model:{value:e.autoReconcileForm.reconciliationDate,callback:function(t){e.$set(e.autoReconcileForm,"reconciliationDate",t)},expression:"autoReconcileForm.reconciliationDate"}})],1),t("el-form-item",{attrs:{label:"对账单余额",prop:"statementBalance"}},[t("el-input",{attrs:{placeholder:"请输入对账单余额"},model:{value:e.autoReconcileForm.statementBalance,callback:function(t){e.$set(e.autoReconcileForm,"statementBalance",t)},expression:"autoReconcileForm.statementBalance"}})],1),t("el-form-item",{attrs:{label:"期初日期"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择期初日期（可选）","value-format":"yyyy-MM-dd"},model:{value:e.autoReconcileForm.startDate,callback:function(t){e.$set(e.autoReconcileForm,"startDate",t)},expression:"autoReconcileForm.startDate"}}),t("div",{staticStyle:{color:"#909399","font-size":"12px","margin-top":"5px"}},[e._v("不选择则期初余额默认为0")])],1),t("el-form-item",{attrs:{label:"对账说明"}},[t("el-input",{attrs:{type:"textarea",placeholder:"可填写本次对账的说明",rows:2},model:{value:e.autoReconcileForm.remark,callback:function(t){e.$set(e.autoReconcileForm,"remark",t)},expression:"autoReconcileForm.remark"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.autoReconcileDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.autoReconcileLoading},on:{click:e.handleAutoReconcile}},[e._v("开始对账")])],1)],1),t("el-dialog",{attrs:{title:"对账详情",visible:e.viewDialogVisible,width:"900px","close-on-click-modal":!1},on:{"update:visible":function(t){e.viewDialogVisible=t}}},[e.viewData?t("div",[t("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("基本信息")])]),t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"科目编码"}},[e._v(e._s(e.viewData.subject?.code))]),t("el-descriptions-item",{attrs:{label:"科目名称"}},[e._v(e._s(e.viewData.subject?.name))]),t("el-descriptions-item",{attrs:{label:"对账日期"}},[e._v(e._s(e.formatDate(e.viewData.reconciliation?.reconciliationDate)))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:e.getStatusType(e.viewData.reconciliation?.status)}},[e._v(e._s(e.getStatusText(e.viewData.reconciliation?.status)))])],1),t("el-descriptions-item",{attrs:{label:"对账说明",span:2}},[e._v(e._s(e.viewData.reconciliation?.remark||"-"))])],1)],1),e.viewData.balanceDetail?t("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("账面余额计算明细")])]),t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"余额方向"}},[e._v(e._s(e.viewData.balanceDetail.balanceDirectionText))]),t("el-descriptions-item",{attrs:{label:"借方总额"}},[e._v(e._s(e.formatMoney(e.viewData.balanceDetail.debitTotal)))]),t("el-descriptions-item",{attrs:{label:"贷方总额"}},[e._v(e._s(e.formatMoney(e.viewData.balanceDetail.creditTotal)))]),t("el-descriptions-item",{attrs:{label:"计算出的账面余额"}},[t("span",{staticStyle:{"font-weight":"bold",color:"#409EFF"}},[e._v(e._s(e.formatMoney(e.viewData.balanceDetail.calculatedBalance)))])])],1)],1):e._e(),e.viewData.comparison?t("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("对账比对")])]),t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"账面余额"}},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.formatMoney(e.viewData.comparison.bookBalance)))])]),t("el-descriptions-item",{attrs:{label:"对账单余额"}},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.formatMoney(e.viewData.comparison.statementBalance)))])]),t("el-descriptions-item",{attrs:{label:"差额",span:2}},[t("span",{style:{fontWeight:"bold",color:Math.abs(e.viewData.comparison.difference)>0?"#F56C6C":"#67C23A"}},[e._v(" "+e._s(e.formatMoney(e.viewData.comparison.difference))+" "),e.viewData.comparison.difference>0?t("span",[e._v("（对账单余额大于账面余额）")]):e.viewData.comparison.difference<0?t("span",[e._v("（对账单余额小于账面余额）")]):t("span",[e._v("（余额一致）")])])])],1)],1):e._e(),e.viewData.entryDetails&&e.viewData.entryDetails.length>0?t("el-card",{attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",{staticStyle:{"font-weight":"bold"}},[e._v("对账期间的凭证明细（共 "+e._s(e.viewData.entryDetails.length)+" 笔）")])]),t("el-table",{attrs:{data:e.viewData.entryDetails,border:"",stripe:"","max-height":"400"}},[t("el-table-column",{attrs:{prop:"voucherNo",label:"凭证编号",width:"120"}}),t("el-table-column",{attrs:{prop:"voucherDate",label:"凭证日期",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.voucherDate))+" ")]}}],null,!1,2815952687)}),t("el-table-column",{attrs:{prop:"summary",label:"摘要","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"debitAmount",label:"借方金额",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatMoney(t.row.debitAmount))+" ")]}}],null,!1,3029429181)}),t("el-table-column",{attrs:{prop:"creditAmount",label:"贷方金额",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatMoney(t.row.creditAmount))+" ")]}}],null,!1,2040855630)}),t("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}})],1)],1):t("el-card",{attrs:{shadow:"never"}},[t("div",{staticStyle:{"text-align":"center",color:"#909399",padding:"20px"}},[e._v(" 对账期间无已过账的凭证明细 ")])])],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.viewDialogVisible=!1}}},[e._v("关闭")])],1)])],1)],1)},i=[],s=(a(4114),a(8111),a(116),a(7588),a(7277)),l=a(412),r={name:"Reconciliation",data(){return{loading:!1,searchForm:{accountId:"",reconciliationDate:"",status:""},reconciliationList:[],subjectList:[],pageInfo:{pageNum:1,pageSize:10,total:0},autoReconcileDialogVisible:!1,autoReconcileLoading:!1,autoReconcileForm:{subjectId:null,reconciliationDate:"",startDate:"",statementBalance:"",remark:""},autoReconcileRules:{subjectId:[{required:!0,message:"请选择会计科目",trigger:"change"}],reconciliationDate:[{required:!0,message:"请选择对账日期",trigger:"change"}],statementBalance:[{required:!0,message:"请输入对账单余额",trigger:"blur"}]},viewDialogVisible:!1,viewData:null}},mounted(){this.loadSubjectList().then(()=>{this.getList()})},methods:{async loadSubjectList(){try{const e=await l.tA.getSubjectTree();200===e.code&&(this.subjectList=this.flattenSubjects(e.data||[]))}catch(e){console.error("加载科目列表失败",e)}},flattenSubjects(e){let t=[];return e.forEach(e=>{t.push(e),e.children&&e.children.length>0&&(t=t.concat(this.flattenSubjects(e.children)))}),t},getSubjectName(e){if(!e)return"";const t=this.subjectList.find(t=>t.id.toString()===e.toString());return t?`${t.code} - ${t.name}`:""},async getList(){this.loading=!0;try{const e={pageNum:this.pageInfo.pageNum,pageSize:this.pageInfo.pageSize};this.searchForm.accountId&&(e.accountId=this.searchForm.accountId),this.searchForm.reconciliationDate&&(e.reconciliationDate=this.searchForm.reconciliationDate),""!==this.searchForm.status&&(e.status=this.searchForm.status);const t=await s.A.get("/reconciliation/page",{params:e}),a=t.data||{};this.reconciliationList=a.records||[],this.pageInfo.total=a.total||0}catch(e){this.$message.error("获取对账列表失败："+(e.response?.data?.message||e.message))}finally{this.loading=!1}},handleSearch(){this.pageInfo.pageNum=1,this.getList()},resetSearch(){this.searchForm={accountId:"",reconciliationDate:"",status:""},this.getList()},handleCurrentChange(e){this.pageInfo.pageNum=e,this.getList()},handleSizeChange(e){this.pageInfo.pageSize=e,this.pageInfo.pageNum=1,this.getList()},showAutoReconcileDialog(){const e=this.subjectList&&this.subjectList.length?Promise.resolve():this.loadSubjectList();e.then(()=>{this.autoReconcileForm={subjectId:null,reconciliationDate:"",startDate:"",statementBalance:"",remark:""},this.$nextTick(()=>{this.$refs.autoReconcileForm&&this.$refs.autoReconcileForm.resetFields()}),this.autoReconcileDialogVisible=!0})},async handleAutoReconcile(){this.$refs.autoReconcileForm.validate(async e=>{if(e){this.autoReconcileLoading=!0;try{const e={subjectId:this.autoReconcileForm.subjectId,reconciliationDate:this.autoReconcileForm.reconciliationDate,statementBalance:this.autoReconcileForm.statementBalance,remark:this.autoReconcileForm.remark},t=await s.A.post("/reconciliation/auto",null,{params:e});200===t.code?(this.$message.success("对账成功"),this.autoReconcileDialogVisible=!1,this.getList()):this.$message.error(t.message||"对账失败")}catch(t){this.$message.error("对账失败："+(t.response?.data?.message||t.message))}finally{this.autoReconcileLoading=!1}}})},async handleView(e){try{const t=await s.A.get(`/reconciliation/detail/${e.id}`);200===t.code?(this.viewData=t.data,this.viewDialogVisible=!0):this.$message.error(t.message||"获取对账详情失败")}catch(t){this.$message.error("获取对账详情失败："+(t.response?.data?.message||t.message))}},async handleDelete(e){this.$confirm("确定要删除该对账记录吗？删除后无法恢复。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await s.A.delete(`/reconciliation/${e.id}`);200===t.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(t.message||"删除失败")}catch(t){this.$message.error("删除失败："+(t.response?.data?.message||t.message))}}).catch(()=>{this.$message.info("已取消操作")})},formatMoney(e){return e||0===e?Number(e).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatDate(e){if(!e)return"-";try{const t=new Date(e);if(isNaN(t.getTime()))return"-";const a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${a}-${o}-${i}`}catch(t){return"-"}},getStatusText(e){const t={0:"未对账",1:"已对账"};return t[e]||"未知"},getStatusType(e){const t={0:"warning",1:"success"};return t[e]||"default"}}},n=r,c=a(1656),u=(0,c.A)(n,o,i,!1,null,"e9f008d6",null),d=u.exports}}]);
//# sourceMappingURL=880.c18117aa.js.map