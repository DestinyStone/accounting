"use strict";(self["webpackChunkdemo"]=self["webpackChunkdemo"]||[]).push([[248],{1248:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"journal-entry-container"},[e._m(0),t("div",{staticClass:"content"},[t("el-card",[t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"凭证编号"}},[t("el-input",{attrs:{placeholder:"请输入凭证编号"},model:{value:e.searchForm.voucherNo,callback:function(t){e.$set(e.searchForm,"voucherNo",t)},expression:"searchForm.voucherNo"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.entryList}},[t("el-table-column",{attrs:{prop:"voucherNo",label:"凭证编号"}}),t("el-table-column",{attrs:{prop:"voucherDate",label:"凭证日期"}}),t("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),t("el-table-column",{attrs:{prop:"totalDebit",label:"借方总额"}}),t("el-table-column",{attrs:{prop:"totalCredit",label:"贷方总额"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",formatter:e.formatStatus}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.viewDetail(a.row)}}},[e._v("查看")]),0===a.row.status?t("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.handlePost(a.row)}}},[e._v("过账")]):e._e(),1===a.row.status?t("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.handleCancelPost(a.row)}}},[e._v("取消过账")]):e._e(),0!==a.row.status||a.row.businessId?e._e():t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.cancelEntry(a.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,total:e.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)],1),t("el-dialog",{attrs:{title:"凭证详情",visible:e.detailVisible,width:"80%"},on:{"update:visible":function(t){e.detailVisible=t}}},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"凭证编号"}},[e._v(e._s(e.selectedEntry.voucherNo))]),t("el-descriptions-item",{attrs:{label:"凭证日期"}},[e._v(e._s(e.selectedEntry.voucherDate))]),t("el-descriptions-item",{attrs:{label:"摘要"}},[e._v(e._s(e.selectedEntry.summary))]),t("el-descriptions-item",{attrs:{label:"状态"}},[e._v(e._s(e.formatStatusText(e.selectedEntry.status)))])],1),t("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.selectedEntryDetails,border:""}},[t("el-table-column",{attrs:{prop:"subjectCode",label:"科目编码"}}),t("el-table-column",{attrs:{prop:"subjectName",label:"科目名称"}}),t("el-table-column",{attrs:{prop:"remark",label:"备注"}}),t("el-table-column",{attrs:{prop:"debitAmount",label:"借方金额"}}),t("el-table-column",{attrs:{prop:"creditAmount",label:"贷方金额"}})],1),t("div",{staticClass:"total-section",staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"total-item"},[t("span",[e._v("合计：")]),t("span",[e._v("借方金额："+e._s(e.selectedEntry.totalDebit))]),t("span",[e._v("贷方金额："+e._s(e.selectedEntry.totalCredit))])])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.detailVisible=!1}}},[e._v("关闭")])],1)],1)],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header"},[t("h2",[e._v("记账凭证")])])}],o=a(7277),l={name:"JournalEntry",data(){return{entryList:[],searchForm:{voucherNo:"",dateRange:[]},currentPage:1,pageSize:10,total:0,detailVisible:!1,selectedEntry:{},selectedEntryDetails:[]}},created(){this.loadData()},methods:{async loadData(){try{const e=await o.A.get("/journal-entry/page",{params:{pageNum:this.currentPage,pageSize:this.pageSize,voucherNo:this.searchForm.voucherNo}});200===e.code&&(this.entryList=e.data.records,this.total=e.data.total)}catch(e){this.$message.error("加载失败")}},search(){this.currentPage=1,this.loadData()},resetSearch(){this.searchForm={voucherNo:"",dateRange:[]},this.search()},handleCurrentChange(e){this.currentPage=e,this.loadData()},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.loadData()},async viewDetail(e){try{const[t,a]=await Promise.all([o.A.get(`/journal-entry/${e.id}`),o.A.get(`/journal-entry/detail/${e.id}`)]);200===t.code&&200===a.code&&(this.selectedEntry=t.data,this.selectedEntryDetails=a.data,this.detailVisible=!0)}catch(t){this.$message.error("加载详情失败")}},async cancelEntry(e){this.$confirm("确定要删除该凭证吗？只能删除草稿状态且未关联业务的凭证","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await o.A.delete(`/journal-entry/${e.id}`);200===t.code?(this.$message.success("删除成功"),this.loadData()):this.$message.error(t.message||"删除失败")}catch(t){const e=t.response?.data?.message||t.message||"删除失败";this.$message.error(e)}}).catch(()=>{this.$message.info("已取消操作")})},formatStatus(e){const t={0:"未过账",1:"已过账"};return t[e.status]||e.status},formatStatusText(e){const t={0:"未过账",1:"已过账"};return t[e]||e},async handlePost(e){this.$confirm("确定要对该凭证进行过账操作吗？过账后将无法修改凭证","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=this.$store.state.user?.id||1,a=await o.A.post(`/posting/${e.id}?userId=${t}`);200===a.code?(this.$message.success("过账成功"),this.loadData()):this.$message.error(a.message||"过账失败")}catch(t){this.$message.error("过账失败："+(t.response?.data?.message||t.message))}}).catch(()=>{this.$message.info("已取消操作")})},async handleCancelPost(e){this.$confirm("确定要取消该凭证的过账吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await o.A.delete(`/posting/${e.id}`);200===t.code?(this.$message.success("取消过账成功"),this.loadData()):this.$message.error(t.message||"取消过账失败")}catch(t){this.$message.error("取消过账失败："+(t.response?.data?.message||t.message))}}).catch(()=>{this.$message.info("已取消操作")})}}},n=l,i=a(1656),c=(0,i.A)(n,s,r,!1,null,"2c1e8e08",null),u=c.exports},7277:function(e,t,a){var s=a(4373),r=a(5129),o=a(9143);const l=s.A.create({timeout:5e3});l.interceptors.request.use(e=>(r.A.state.token&&(e.headers["Authorization"]="Bearer "+r.A.state.token),e),e=>(console.log(e),Promise.reject(e))),l.interceptors.response.use(e=>{const t=e.data;return 200!==t.code?((0,o.Message)({message:t.message||"请求失败",type:"error",duration:5e3}),Promise.reject(new Error(t.message||"请求失败"))):t},e=>(e.response&&401===e.response.status&&(r.A.dispatch("logout"),location.reload()),(0,o.Message)({message:e.message||"网络异常",type:"error",duration:5e3}),Promise.reject(e))),t.A=l}}]);
//# sourceMappingURL=248.9ebe94c7.js.map